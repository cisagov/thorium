ARG IMAGE="ubuntu:22.04"
FROM $IMAGE

WORKDIR /app

RUN apt update && \
    apt install -y python3 python3-pip git file cabextract p7zip-full tar unzip rpm2cpio cpio build-essential binutils coreutils xterm jq && \
    apt clean && \
    rm -rf /var/lib/apt/lists/*

# install from source
RUN git clone https://github.com/intel/cve-bin-tool.git
RUN pip install -e cve-bin-tool
RUN rm -rf /app/cve-bin-tool/.git
RUN rm -rf /app/cve-bin-tool/test
RUN sed -i 's/RATE = 10/RATE = 1/g' /app/cve-bin-tool/cve_bin_tool/async_utils.py

ADD wrapper.bash /app/.
RUN chmod +x /app/wrapper.bash

# download database
RUN cve-bin-tool -l info --update now

ENTRYPOINT ["bash", "/app/wrapper.bash"]