<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Scaler - Thorium</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Thorium</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="scaler"><a class="header" href="#scaler">Scaler</a></h1>
<hr />
<p>Thorium scalers are responsible for determining when and where reactions/jobs
are spawned. It accomplishes this by crawling the deadline stream and based
on fair share scheduling logic. This means that some portion of your cluster
will be dedicated to the most pressing jobs based on deadline while another
portion will be trying to fairly executing everyones jobs evenly. This allows
for users to spawn large groups of reactions/jobs without fear of abusing
the cluster and preventing others from accomplishing tasks.</p>
<p>The scaler currently support 3 scheduling targets:</p>
<ul>
<li>Kubernetes</li>
<li>Bare metal</li>
<li>Windows</li>
</ul>
<h1 id="scheduling-algorithms"><a class="header" href="#scheduling-algorithms">Scheduling Algorithms</a></h1>
<hr />
<p>The scaler uses a pool based scheduling system where each pool has its own
resources that are allocated based on their own scheduling algorithm. The
current pools in Thorium are:</p>
<ul>
<li>Deadline</li>
<li>Fair share</li>
</ul>
<h3 id="deadline-pool"><a class="header" href="#deadline-pool">Deadline Pool</a></h3>
<p>The deadline pool is scheduled in a first come first serve basis based on the
deadline set by the SLA for specific images. This means that jobs earlier in
the deadline stream will get priority over jobs later in the queue. It is
intended to ensure that some portion of the cluster is always working to meet
the SLA for all jobs. A downside of this is that heavy users can cause other
users jobs to be stuck in the created state for a long period of time.</p>
<h3 id="fair-share-pool"><a class="header" href="#fair-share-pool">Fair Share Pool</a></h3>
<p>The fair share pool is intended to balance resources across users, not images,
resulting in responsive execution of jobs even when heavy users are active.
This is accomplished by the scaler scoring users based on their currently
active jobs across all pools. The score increased is based on the resources
required for their currently active jobs. When scheduling jobs for the fair
share pool the users with the lowest score will get the highest priority.</p>
<p>workers that are spawned in the fairshare pool will have a limited lifetime
depending on their original lifetime settings.</p>
<div class="table-wrapper"><table><thead><tr><th>original</th><th>under fair share</th></tr></thead><tbody>
<tr><td>None</td><td>Can claim new jobs for 60 seconds before terminating</td></tr>
<tr><td>Time Limited</td><td>Can claim new jobs for up to 60 (or a lower time specified limit) seconds before terminating</td></tr>
<tr><td>Job Limited</td><td>Can claim a single job</td></tr>
</tbody></table>
</div>
<p>This limit is in place to ensure workers spawned under fairshare churn often
to allow for resources to be shared across users with minimal thrashing.</p>
<h1 id="scaler-faqs"><a class="header" href="#scaler-faqs">Scaler FAQ's</a></h1>
<hr />
<h3 id="why-do-we-only-preempt-pods-when-we-are-above-90-load"><a class="header" href="#why-do-we-only-preempt-pods-when-we-are-above-90-load">Why do we only preempt pods when we are above 90% load</a></h3>
<p>This is to prevent us from wasting resources spinning pods down when we have
free resources still. If there are no jobs for that stage it will spin itself
down but if we have free resources then allowing them to continue to execute jobs
lowers the amount of orphaned jobs.</p>
<h3 id="does-thoriums-scaler-hold-the-full-docker-image-in-its-cache"><a class="header" href="#does-thoriums-scaler-hold-the-full-docker-image-in-its-cache">Does Thorium's scaler hold the full docker image in its cache?</a></h3>
<p>No the Thorium scaler doesn't download or have the full image at any point. It does
however contain metadata about docker images. This is what allows the scaler to
override the original entrypoint/command while passing that info to the agent.</p>
<h3 id="i-see-an-external-scaler-what-is-that"><a class="header" href="#i-see-an-external-scaler-what-is-that">I see an External scaler what is that?</a></h3>
<p>Thorium allows users to build their own scaler and purely use it as a job/file
metadata store. To do this you will set your images to use the External scaler.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../architecture/api.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../architecture/agent.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../architecture/api.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../architecture/agent.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
