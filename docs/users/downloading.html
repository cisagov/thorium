<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Downloading Files - Thorium</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Thorium</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="downloading-files"><a class="header" href="#downloading-files">Downloading Files</a></h1>
<p>If you need to download a file to carry out further manual analysis steps, you can do so via the Web UI or Thorctl.
Because samples stored in Thorium are often malicious, they are downloaded from Thorium in a non-executable state,
either in a safe
<a href="../help/faq.html#what-is-cart-and-how-can-i-uncart-malware-samples-that-i-download-from-thorium">CaRTed</a> format
or as encrypted ZIP files. This means that before a downloaded file can be analyzed, it must be either be unCaRTed
or decrypted/extracted from the ZIP archive to return it to its original, potentially executable, state. If you are
working with malicious or potentially malicious files, only unCaRT them in a safe location such as a firewalled
virtual machine. Keep in mind that most anti-virus applications will immediately detect and quarantine known malware
after extraction, so disabling anti-virus applications entirely may be necessary to effectively extract the sample.
Be careful when dealing with extracted malware samples!</p>
<h3 id="cart-vs-encrypted-zip"><a class="header" href="#cart-vs-encrypted-zip">Cart vs Encrypted Zip</a></h3>
<p>Thorium supports two different download types each with its own pros and cons:</p>
<div class="table-wrapper"><table><thead><tr><th>Capability</th><th>CaRT</th><th>Encrypted Zip</th></tr></thead><tbody>
<tr><td>Encrypted</td><td>✅</td><td>✅</td></tr>
<tr><td>Compressed</td><td>✅</td><td>✅</td></tr>
<tr><td>Streaming Extraction</td><td>✅</td><td>❌</td></tr>
<tr><td>API Load</td><td>low</td><td>high</td></tr>
<tr><td>Native Windows/Linux/Mac Support</td><td>❌</td><td>✅</td></tr>
</tbody></table>
</div>
<p>At a high level encrypted zips are more user friendly but are less performant
and cause a high load on the API. When peforming actions at scale or working
with large files using CaRT is highly recommended.</p>
<h3 id="web-ui-sample-file-download"><a class="header" href="#web-ui-sample-file-download">Web UI Sample File Download</a></h3>
<hr />
<p>You can choose between <a href="../help/faq.html#what-is-cart-and-how-can-i-uncart-malware-samples-that-i-download-from-thorium">CaRTed</a>
and encrypted ZIP format when downloading files using the Thorium Web UI. If the file is in the CaRTed format You will need to use
a tool such as Thorctl to unCaRT the file after it has been downloaded and moved into a sandboxed environment.</p>
<video autoplay loop controls>
  <source src="../static_resources/files/file-download.mp4", type="video/mp4">
</video>
<h3 id="thorctl-file-download"><a class="header" href="#thorctl-file-download">Thorctl File Download</a></h3>
<hr />
<p>Alternatively, you may use Thorctl to download the file on the command line in either a CaRTed or unCaRTed format.
You can download a single file by its sha256 hash using the following Thorctl command:</p>
<pre><code class="language-bash">thorctl files download &lt;sha256&gt;
</code></pre>
<p>Thorctl's current behavior is to download the file in a CaRTed format by default. Downloading files as encrypted ZIP's is not
currently supported in Thorctl. If you want to immediately unCaRT the file, you can use the <code>-u</code> or <code>--uncarted</code> flag.</p>
<pre><code class="language-bash">thorctl files download --uncarted &lt;sha256&gt;
</code></pre>
<p>If you want to download the file to a different path, that is not in the current working directory, you can use the
<code>-o/--output</code> flag.</p>
<pre><code class="language-bash">thorctl files download --output /path/to/download/directory &lt;sha256&gt;
</code></pre>
<p>You can also download multiple files by specifying a metadata tag that the downloaded files must have and the <code>-l/--limit</code> flag
to specify how many files you would like to download.</p>
<pre><code class="language-bash">thorctl files download --carted --limit 100 --tags Incident=10001234
</code></pre>
<p>If you do not specify a limit count when you provide a key/value tag, Thorctl will default to downloading a maximum of 10 files.</p>
<h3 id="cartinguncarting-files"><a class="header" href="#cartinguncarting-files">CaRTing/UnCaRTing Files</a></h3>
<hr />
<p>Thorctl also has the ability to CaRT and unCaRT local files. This is particularly helpful if you want to download a file
in a CaRTed format and then unCaRT it in a quarantined location later or CaRT files to store after
analysis is complete.</p>
<h4 id="carting-files"><a class="header" href="#carting-files">CaRTing Files</a></h4>
<p>To CaRT a file, simply run:</p>
<pre><code class="language-bash">thorctl cart &lt;path-to-file&gt;
</code></pre>
<p>You can also CaRT multiple files in one command:</p>
<pre><code class="language-bash">thorctl cart &lt;path-to-file1&gt; &lt;path-to-file2&gt; &lt;path-to-file3&gt;
</code></pre>
<h5 id="specifying-an-output-directory"><a class="header" href="#specifying-an-output-directory">Specifying an Output Directory</a></h5>
<p>CaRTing with Thorctl will create a directory called "carted" in your current directory containing the CaRTed files
with the <code>.cart</code> extension. To specify an output directory to save the CaRTed files to, use the <code>-o</code> or <code>--output</code> flag:</p>
<pre><code class="language-bash">thorctl cart --output ./files/my-carted-files &lt;path-to-file&gt;
</code></pre>
<h5 id="carting-in-place"><a class="header" href="#carting-in-place">CaRTing In-Place</a></h5>
<p>You can also CaRT the files in-place, replacing the original files with the new CaRTed files, by using the
<code>--in-place</code> flag:</p>
<pre><code class="language-bash">thorctl cart --in-place &lt;path-to-file&gt;
</code></pre>
<h5 id="carting-directories"><a class="header" href="#carting-directories">CaRTing Directories</a></h5>
<p>Giving the path of a directory to CaRT will recursively CaRT every file within the directory.</p>
<pre><code class="language-bash">thorctl cart &lt;path-to-dir&gt;
</code></pre>
<p>Because CaRTed files will be saved together in one output folder, collisions can occur if files have the same name
within a directory structure. For example, let's say I have a directory called <code>my-dir</code> with the following structure:</p>
<pre><code>my-dir
├── dir1
│   └── malware.exe
└── dir2
    └── malware.exe
</code></pre>
<p>Because Thorctl will recursively CaRT all files within <code>my-dir</code> and save them in one output directory, one
<code>malware.exe.cart</code> will overwrite the other. To avoid such collisions, you can either use the aforementioned
<code>--in-place</code> flag to CaRT the files in-place or use the <code>-D</code> or <code>--preserve-dir-structure</code> flag to output files in a
structure identical to the input directory. So CaRTing <code>my-dir</code> with the above structure using the
<code>--preserve-dir-structure</code> option would yield the output directory <code>carted</code>, having the following structure:</p>
<pre><code>carted
└── my-dir
    ├── dir1
    │   └── malware.exe.cart
    └── dir2
        └── malware.exe.cart
</code></pre>
<h5 id="filtering-which-files-to-cart"><a class="header" href="#filtering-which-files-to-cart">Filtering Which Files to CaRT</a></h5>
<p>There may be cases where you want to CaRT only certain files within a folder. Thorctl provides the ability to either
inclusively or exclusively filter with regular expressions using the <code>--filter</code> and <code>--skip</code> flags, respectively.
For example, to CaRT only files with the <code>.exe</code> extension within a directory, you could run the following command:</p>
<pre><code class="language-bash">thorctl files cart --filter .*\.exe ./my-dir
</code></pre>
<p>Or to CaRT everything within a directory except for files starting with <code>temp-</code>, you could run this command:</p>
<pre><code class="language-bash">thorctl files cart --skip temp-.* ./my-dir
</code></pre>
<p>Supply multiple filters by specifying filter flags multiple times:</p>
<pre><code class="language-bash">thorctl files cart --filter .*\.exe --filter .*evil.* --skip temp-.* ./my-dir
</code></pre>
<p>The filter and skip regular expressions must adhere to the format used by the Rust
<a href="https://docs.rs/regex/latest/regex/#syntax">regex crate</a>. Fortunately, this format is very similar to
most other popular regex types and should be relatively familiar. A helpful site to build and test your
regular expressions can be found here: <a href="https://rustexp.lpil.uk/">https://rustexp.lpil.uk</a></p>
<h4 id="uncarting-files"><a class="header" href="#uncarting-files">UnCaRTing Files</a></h4>
<p>UnCaRTing in Thorctl looks very similar to CaRTing as explained above but uses the <code>uncart</code> command instead:</p>
<pre><code class="language-bash">thorctl uncart &lt;path-to-CaRT-file&gt;
</code></pre>
<p>You can specify multiple CaRT files, unCaRT in-place, preserve the input directory structure, and apply filename
filters just as with the <code>cart</code> command. For example:</p>
<pre><code class="language-bash">thorctl uncart --filter .*\.cart --skip temp-.* --output ./my-output --preserve-dir-structure ./my-carts hello.cart
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../users/searching_results.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../users/commenting.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../users/searching_results.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../users/commenting.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
