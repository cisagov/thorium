<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Jobs Stuck At Created - Thorium</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Thorium</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="jobs-stuck-in-created-state"><a class="header" href="#jobs-stuck-in-created-state">Jobs Stuck In Created State</a></h1>
<p>When jobs are stuck in the created state for an extended period of time this
can be due to multiple issues:</p>
<ul>
<li>High load</li>
<li>Outdated agent</li>
<li>Missing Volumes</li>
</ul>
<h3 id="high-load"><a class="header" href="#high-load">High Load</a></h3>
<hr />
<p>When the cluster has a high number of jobs in queue, jobs may be
in a created state for an extended period of time. The fairshare scheduler
should help mitigate this when other users are the cause of the load (the fair
share scheduler balances across users, not images/pipelines). If the user
experiencing the stuck jobs is also the cause of heavy load, the user needs
to wait for their in-progress jobs to complete before their other jobs can
be scheduled.</p>
<h3 id="outdated-agents"><a class="header" href="#outdated-agents">Outdated Agents</a></h3>
<hr />
<p>A common issue for jobs being stuck in the created state after updating Thorium
is the agent failed to update. Before the agent claims any job it will
check the version of the API against its own. If it is the incorrect version
then the agent will exit without claiming a job.</p>
<h4 id="getting-the-current-version"><a class="header" href="#getting-the-current-version">Getting the current version</a></h4>
<p>In order to get the current api version run the following command:</p>
<script>
  let base = window.location.origin;
  document.write("<pre>");
  document.write("<code class=\"language-bash  hljs\">");
  document.write("curl " + base + "/api/version");
  document.write("</code>");
  document.write("</pre>");
</script>
<h4 id="outdated-agents-kubernetes"><a class="header" href="#outdated-agents-kubernetes">Outdated Agents: Kubernetes</a></h4>
<p>In order to determine if the agent version is incorrect on kubernetes, first get
pod logs with the following:</p>
<pre><code>kubectl get pods -n &lt;NAMESPACE&gt; | grep "/1" | awk '{print $1}' | kubectl logs -n &lt;Namespace&gt; -f
</code></pre>
<p>If any of the logs show the agent exiting without claiming a job due to
version mismatch, run the following command to update the Thorium
agent on all nodes.</p>
<pre><code>kubectl rollout restart deployment operator -n thorium
</code></pre>
<h4 id="outdated-agents-bare-metal"><a class="header" href="#outdated-agents-bare-metal">Outdated Agents: Bare Metal</a></h4>
<p>On bare metal machines the agent is auto updated by the Thorium reactor. To
confirm if the version is correct, simply run the following command to check the
reactor:</p>
<pre><code>/opt/thorium/thorium-reactor -V
</code></pre>
<p>Then to check the agent, run the following:</p>
<pre><code>/opt/thorium/thorium-agent -V
</code></pre>
<p>In order to update the reactor, run the following command:</p>
<script>
  let hostname = window.location.hostname;
  document.write("<pre>");
  document.write("<code class=\"language-bash  hljs\">");
  document.write("curl " + hostname + ":39080/api/binaries/linux/x86-64/thorium-reactor -o thorium-reactor");
  document.write("</code>");
  document.write("</pre>");
</script>
<p>In order to update the agent, run the following command:</p>
<script>
  document.write("<pre>");
  document.write("<code class=\"language-bash  hljs\">");
  document.write("curl " + hostname + ":39080/api/binaries/linux/x86-64/thorium-agent -o thorium-agent");
  document.write("</code>");
  document.write("</pre>");
</script>
<h3 id="missing-volumes"><a class="header" href="#missing-volumes">Missing Volumes</a></h3>
<p>Another common issue that can cause K8s-based workers to get stuck in the
created state is missing volumes. This occurs when the user has defined their image
to require a volume, but the volume has not been created in K8s. This causes
the pod to be stuck in the ContainerCreating state in K8s. To get pods in
this state run the following command</p>
<pre><code>kubectl get pods -n &lt;NAMESPACE&gt; | grep "ContainerCreating"
</code></pre>
<p>Then looks to see if any pods have been in that state for an extended period of
time by checking the age of the pod. For example, this pod has been stuck for 10
minutes and is likely missing a volume.</p>
<pre><code>➜ ~ kubectl get pods
NAME       READY   STATUS              RESTARTS   AGE
underwater-basketweaver-njs8smrl 0/1     ContainerCreating   0          10m
</code></pre>
<p>To confirm this is the issue describe the pod with the following command and
check the events:</p>
<pre><code>kubectl describe pod/&lt;POD&gt; -n &lt;NAMESPACE&gt;
</code></pre>
<p>If there is an event similar to the following, you are missing a volume
that needs to be created.</p>
<pre><code>Events:
  Type     Reason       Age                   From               Message
  ----     ------       ----                  ----               -------
  Normal   Scheduled    10m45s                 default-scheduler  Successfully assigned &lt;NAMESPACE&gt;/&lt;POD&gt; to &lt;NODE&gt;
  Warning  FailedMount  51s (x12 over 10m45s)  kubelet            MountVolume.SetUp failed for volume "important-volume" : configmap "important-volume" not found
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../admins/common_issues.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../admins/network_policies/network_policies.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../admins/common_issues.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../admins/network_policies/network_policies.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="../../ace.js"></script>
        <script src="../../editor.js"></script>
        <script src="../../mode-rust.js"></script>
        <script src="../../theme-dawn.js"></script>
        <script src="../../theme-tomorrow_night.js"></script>

        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
